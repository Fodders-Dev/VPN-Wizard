<!doctype html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VPN Wizard</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <main class="app">
    <header class="hero">
      <div class="hero-top">
        <div class="title" data-i18n="app_title">VPN Wizard</div>
        <div class="lang-toggle" role="group" aria-label="Language">
          <button type="button" class="lang-btn" data-lang="ru">RU</button>
          <button type="button" class="lang-btn" data-lang="en">EN</button>
        </div>
      </div>
      <div class="subtitle" data-i18n="app_subtitle">Простая настройка AmneziaWG VPN на вашем сервере</div>
    </header>

    <section class="card">
      <h2 data-i18n="step1_title">Шаг 1. Доступ к серверу</h2>
      <form id="provision-form">
        <label>
          <span data-i18n="server_host_label">IP или хост сервера</span>
          <input name="host" placeholder="1.2.3.4" data-i18n-placeholder="server_host_placeholder" required />
        </label>
        <label>
          <span data-i18n="ssh_user_label">SSH пользователь</span>
          <input name="user" placeholder="root" data-i18n-placeholder="ssh_user_placeholder" required />
        </label>
        <label>
          <span data-i18n="ssh_password_label">SSH пароль</span>
          <input name="password" type="password" placeholder="optional if key" data-i18n-placeholder="ssh_password_placeholder" />
        </label>
        <label>
          <span data-i18n="client_name_label">Имя клиента (необязательно)</span>
          <input name="client_name" placeholder="grandma-phone" data-i18n-placeholder="client_name_placeholder" />
        </label>
        <label class="advanced">
          <span data-i18n="ssh_key_label">SSH ключ (необязательно)</span>
          <textarea name="key_content" placeholder="paste private key" data-i18n-placeholder="ssh_key_placeholder"></textarea>
        </label>
        <label class="advanced">
          <span data-i18n="udp_port_label">UDP порт сервера</span>
          <input name="listen_port" type="number" min="1" max="65535" value="3478" />
        </label>
        <div class="server-tools">
          <button type="button" id="check-server-btn" class="secondary" data-i18n="check_server_btn">Проверить сервер</button>
          <div id="server-status" class="server-status" data-i18n="server_status_idle">Сервер не проверен</div>
          <div id="server-meta" class="server-meta"></div>
          <label class="toggle hidden" id="reconfigure-toggle">
            <input type="checkbox" id="reconfigure-checkbox" />
            <span data-i18n="reconfigure_label">Показать настройку сервера</span>
          </label>
        </div>
        <div class="toggle-row">
          <label class="toggle">
            <input type="checkbox" id="simple-toggle" checked />
            <span data-i18n="simple_mode_label">Простой режим</span>
          </label>
          <span class="toggle-hint" data-i18n="simple_mode_hint">Скрыть расширенные поля</span>
        </div>
        <button type="submit" id="provision-btn" data-i18n="provision_btn">Настроить сервер</button>
        <button type="button" id="add-client-btn" class="secondary" data-i18n="add_client_btn">Добавить клиента</button>
      </form>
    </section>

    <section class="card" id="onboarding-card">
      <h2 data-i18n="onboarding_title">Быстрый старт</h2>
      <ol class="onboarding-list">
        <li data-i18n="onboarding_step1">1) Введите IP/хост, SSH пользователя и пароль или ключ.</li>
        <li data-i18n="onboarding_step2">2) Нажмите "Проверить сервер" - если VPN уже есть, появятся клиенты.</li>
        <li data-i18n="onboarding_step3">3) Если нет - нажмите "Настроить сервер" и скачайте конфиг и QR.</li>
        <li data-i18n="onboarding_step4">4) При блокировках попробуйте другой UDP порт или префикс tyumen-.</li>
      </ol>
    </section>

    <section class="card" id="servers-card">
      <h2 data-i18n="servers_title">Мои серверы</h2>
      <div id="servers-empty" data-i18n="servers_empty">Пока нет сохранённых серверов.</div>
      <div id="servers-list" class="servers-list"></div>
    </section>

    <section class="card" id="progress-card">
      <h2 data-i18n="step2_title">Шаг 2. Прогресс</h2>
      <div class="progress-bar" aria-hidden="true">
        <div id="progress-fill" class="progress-fill"></div>
      </div>
      <div class="spinner" aria-hidden="true"></div>
      <div id="status" data-i18n="status_waiting">Ожидание...</div>
      <button type="button" id="toggle-log-btn" class="secondary" data-i18n="toggle_log_btn">Показать лог</button>
      <div id="progress-log" class="log hidden"></div>
    </section>

    <section class="card hidden" id="clients-card">
      <h2 data-i18n="clients_title">Клиенты</h2>
      <div id="clients-empty" data-i18n="clients_empty">Клиенты не найдены.</div>
      <div id="clients-list" class="clients-list"></div>
    </section>

    <section class="card" id="result-card">
      <h2 data-i18n="step3_title">Шаг 3. Скачать</h2>
      <a id="download-link" class="download" href="#" download="client1.conf" data-i18n="download_btn">Скачать конфиг</a>
      <a id="qr-download" class="secondary qr-download hidden" href="#" download="client1.png" data-i18n="download_qr_btn">Скачать QR</a>
      <img id="qr-image" alt="QR code" />
    </section>

    <section class="card" id="faq-card">
      <h2 data-i18n="faq_title">FAQ</h2>
      <details>
        <summary data-i18n="faq_what_is_title">Что это за бот?</summary>
        <p data-i18n="faq_what_is_body">VPN Wizard подключается к вашему серверу по SSH и автоматически настраивает быстрый VPN. В результате вы получаете готовые конфиги и QR.</p>
      </details>
      <details>
        <summary data-i18n="faq_safe_title">Это безопасно?</summary>
        <p data-i18n="faq_safe_body">Бот использует ваши SSH-данные только для настройки. Мы не храним пароли, всё выполняется на вашем сервере.</p>
      </details>
      <details>
        <summary data-i18n="faq_ports_title">Что делать, если VPN не работает?</summary>
        <p data-i18n="faq_ports_body">Попробуйте другой UDP порт в расширенных настройках (например 3478 или 33434).</p>
      </details>
      <details>
        <summary data-i18n="faq_tyumen_title">Как добавить клиента?</summary>
        <p data-i18n="faq_tyumen_body">Введите имя клиента и нажмите "Добавить клиента". Для обхода блокировок используйте префикс tyumen-.</p>
      </details>
    </section>
  </main>

  <script src="config.js"></script>
  <script src="app.js"></script>
</body>

</html>
